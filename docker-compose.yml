version: '3'
services:
    db:
        image: jbergstroem/mariadb-alpine
        env_file:
            - docker/.env-db
    minio:
        image:   'minio/minio'
        env_file:
            - docker/.env-minio
        entrypoint: sh
        command: -c 'mkdir -p /data/mbt && minio server --address :9000 /data'
    api-nginx:
        image: "tienvx/mbt-examples-api-nginx:v1.15.1"
        depends_on:
            - api
    api:
        image: "tienvx/mbt-examples-api:v1.15.1"
        depends_on:
            - db
            - minio
        env_file:
            - docker/.env
    worker:
        image: "tienvx/mbt-examples-worker:v1.15.1"
        depends_on:
            - db
            - minio
        env_file:
            - docker/.env
        command: ["wait-for", "db:3306", "--timeout=99", "--", "php", "/usr/local/src/app/bin/console", "messenger:consume", "async"]
    admin:
        image: "tienvx/mbt-admin:v1.15.1"
        depends_on:
            - api
